<!--script>
**************** H5GG JS script engine (v7.5 update) ********************
h5gg is an engine object, which can call the following functions (similar to the lua interface of Android gg, but the parameters are somewhat different)
h5gg.require(H5GG version number); //Set the minimum H5GG version number required by the script, which can be written in the first line at the beginning of the script
h5gg.setFloatTolerance('floating-point deviation'); //Set the deviation range of F32/F64 floating-point search, the engine defaults to 0.0
h5gg.searchNumber('value', 'type', 'search lower limit', 'search upper limit'); //Search or secondary search (improve) exact value
h5gg.searchNearby('value', 'type', 'adjacent range'); //Nearby (joint) search, consistent with igg's
h5gg.getValue('address', 'type'); //Read the value of the specified address, return the value string
h5gg.setValue('Address', 'Value', 'Type'); //Set the value of the specified address, return success or failure
h5gg.editAll('value', 'type'); //Modify all the values ​​in the search results (cannot be called after clearing the results), and return the number of successful modifications
h5gg.getResultsCount(); //Get the total number of search results, return the total number
h5gg.getResults('Get the number', 'Skip the number'); //Get the result array, each element has three attributes of address, value and type
h5gg.clearResults(); //Clear search results, start a new search
h5gg.getRangesList('module file name'); //Return the module array, the module has start (base address), end (end address), name (path) attributes
    (If the module file name=0, it will return the APP main program module information, if the module file name is not passed in, it will return a list of all modules)
h5gg.loadPlugin('OC class name','dylib path'); //Load the dylib plugin and return the object instance of the OC class name in the plugin
    (The returned OC object instance can be called directly in js, dylib supports absolute path or relative path in .app)
Special for the cross-process version (the html of the plug-in for the cross-process version needs to be called to select the process first):
h5gg.setTargetProc(process number); //Set the current target process, return success or failure
h5gg.getProcList('process name'); //Get the process array, the elements in the array have pid (process number), name (process name) attributes
    (If the process name is not passed in, it will return a list of all running app processes, which can be called periodically to determine whether the target process has ended)
Other interfaces:
setButtonImage(icon); //Set the icon of the floating button, you can pass in the http starting URL image or the base64 encoded DataURL image
setButtonAction(js callback function); //Set a custom floating button icon click action, which is called when a js function is passed in
setWindowRect(x, y, width, height); //Modify the position and size of the floating window on the screen
setWindowDrag(x, y, width, height); //Set the area where the floating window can be dragged in the floating window
setWindowTouch (whether to respond to touch); //true=the entire floating window cannot be touched by touch, false=the entire floating window can be touched by touch
setWindowVisible(display status of the floating window), //Set the visibility of the floating window, true=display, false=hidden
setLayoutAction(js callback function); //Set the js callback when the screen rotates or the iPad split screen floats, and the callback function parameters are (width, height)
Notice:
1: The address parameter supports automatic identification in decimal or hexadecimal format starting with 0x, other parameters must be in string format
2: Floating point types are divided into: F32, F64, signed numbers: I8, I16, I32, I64, unsigned numbers: U8, U16, U32, U64
3: If there are many search results, do not get all the data at one time with getResults, it is easy to cause memory explosion, flashback and crash, and should be obtained in sections
4: The address and value of the search result are all string types. If you want to do digital operations, please use Number(x) to convert them into numeric types before you can perform operations.
5: In lua, the string type on both sides of the + sign will be automatically converted into a numeric type. If the + sign in js is a string, the two strings will be connected)
6: The first array index in lua starts from [1], and the first array index in js starts from [0], which requires special attention
7: The numeric type can be converted into a hexadecimal string format with x.toString(16), but x must be a numeric type to be converted successfully
8: The numerical value of the search supports the range format, such as "50~100", such as "2.3~7.8", both numerical search and adjacent (joint) search are supported
9: The default size of the floating window is 370x370, the position and size and the draggable area can be set through the js interface when the H5 page starts
</script>
<!---->
<!--
H5GG version update record:
H5GG v3.5 is officially released:
1: Fix the problem that individual APPs get stuck and the floating menu disappears
2: Fix the problem of floating point display as 0 and distinguish floating point display
3: Repair the proximity search, keep the matching original data, keep the original data format, basically the same as igg
4: Search to exclude part of the plug-in's own data
5: Increase the prompt information box and text in the search
6: Increase the result list slide down to automatically load more data
7: Fix the problem that the search fails if the upper limit is too large
H5GG v3.6 beta version:
1: Optimize the parsing of js script interface address parameters, you can use decimal or hexadecimal starting with 0x to automatically identify without manual conversion
2: Add script loading function, which can be loaded from the Documents directory of the current APP, or the js script in the server can be loaded from the URL
H5GG v3.7 version test:
Added script exception error prompt, don't worry about the script not responding anymore.
Added search for js in the .app directory, you can package js scripts together with ipa to avoid jailbreaking.
H5GG v3.8 is officially released:
1: Optimize js script h5gg interface getValue/setValue address parameter parsing, you can use decimal or hexadecimal starting with 0x to automatically identify without manual conversion
2: Add the script js file loading function, which can be loaded from the .app main program directory in the ipa of the current APP, can also be loaded from the Documents data directory of the current APP, or can load the js script in the server from the URL
3: Added script exception error prompt, don't worry about js script writing wrong and no response. The error prompt is specific to the file, line number, and column number.
4: Removing UIKit injection is more stable!
H5GG v3.9 beta version:
1: Optimize the prompts during execution after loading the script to avoid exceptions when multiple clicks are triggered without prompts during execution
2: Enhance the JS error prompt module to avoid no JS error prompt message after the H5 file is corrected
3: Fix the problem that the H5 prompt information box of some APPs is displayed in the lower layer of the floating window
4: Fix loading JS script, if the engine prompts an error, the interface is stuck
H5GG v4.0 beta version:
1: Optimize the proportional display of the vertical screen interface, only occupy half of the screen, not the full screen, optimize the problem that some app floating windows will disappear, and now it will not disappear at all
2: In the new script list, you can choose js or html format from the local file manager
3: Script loading adds html format support, you can select local H5 files or network H5 links, and automatically replace the current interface
4: Increase the js script to request http network Get/Post permission (using Baidu jquery ajax by yourself) Note: The local h5 interface can request any domain name, and the network H5 page can only request the same domain name.
H5GG v4.1 test:
1: Click the floating button for the first time to detect no network and give a pop-up reminder
2: Increase the interface function of js setting the floating button network icon
3: Add the interface function of js to set the position and size of the floating window
4: You can touch the non-sliding area of ​​the floating window to drag the floating window
5: Optimize the display of floating-point numbers, including the data returned by the interface and js interface (more accurate than igg)
H5GG v4.2 test:
1: Add getRangesList interface, you can get module list and module base address
2: Increase the ability of setValue to modify read-only memory, and automatically process memory permission attributes
3: Add value range search function, such as "50~100", such as "2.3~7.8"
4: Added the function of making dylibs, which can generate exclusive dylibs for your own icons and menus
5: Fix the bug that sometimes the floating button may be displayed on the input method
H5GG v4.2.1 test:
1: Fixed the problem that some APPs did not respond when selecting scripts from the file manager
H5GG v4.2.2 test:
1: Check if there is a FastClick module in H5, H5GG no longer needs this module, please delete it from the end of H5, otherwise the interface will be stuck
H5GG v4.2.3 test:
1: Fix the problem that the pop-up box is stuck and the interface is unresponsive in some cases
H5GG v4.3 test:
1: Redo the global pop-up box to perfectly present, completely solve the problem of card interface, disappear, display to the lower layer, etc.
2: Add js to set the draggable area of ​​the floating window, custom H5 interface needs to call the js setting before it can be dragged
3: Solved the problem that some apps did not respond when selecting scripts from the file manager
H5GG v4.4 test:
1: Fix the problem that the pop-up box is displayed in the lower layer in some APPs
2: Fix the problem that causes the cydia store page to display abnormally
H5GG v4.5 test:
1: Fixed the problem that the continuous pop-up box in some APPs may be displayed to the lower layer
2: Fixed the issue that the floating button in version 4.4 would be displayed in the system app
H5GG v5.0 release:
1: Officially supports cross-process mode, and supports three modes: jailbreak-free injection, jailbreak injection, and jailbreak cross-process non-injection
The first cross-process version is the iMemEditor binding version, which needs to be opened and used from iME, and the independent app version will be released by shadow later
2: Adjust to allow non-jailbroken devices to make dylibs, but you have to find a way to export dylib files from App documentation
3: Fix the problem that the floating button suddenly disappears due to switching pages when some apps are started
4: Fix the problem that setValue may fail to modify the base address data on some devices
H5GG v5.1 test:
1: The cross-process version is changed to an independent app developed by shadow, and the compatibility problem in the 14 system is fixed
3: Fix the problem that the cross-process version cannot call getRangesList to obtain the module base address
4: Replace the H5GG special icon designed by shadow, more tasteful
H5GG v5.2 test:
1: Fix the problem that the cross-process version cannot select the target in the C1 jailbreak environment
2: Added the target selection js interface call for the cross-process version, the normal version does not need to be called
H5GG v5.3 test:
1: C1 jailbreak repaired by shadow may prompt no network problem
2: Update the adaptation scheme of 12 systems provided by QQ nickname
3: The cross-process version is adjusted to start the automatic display window interface
H5GG v5.4 test:
1: Fix the problem that the list will not be automatically cleared after cross re-selection process
2: Adjust the layout of the left button interface to be more intuitive and clear
3: For individual devices that do not have access to the Internet, add detailed prompts
H5GG v5.5 test:
1: Fix the abnormal display of the prompt box in js of some devices
2: Fix the problem that some devices click to make plug-in cross-process APP flashback
3: Fixed the problem that some devices failed to make plug-ins
4: Fix the white screen problem of the cross-process version APP after installing the universal version
5: Optimize the display format problem of F32/F64 less than 1.0
H5GG v5.6 test:
1: Optimize the error message of numerical search and adjacent search parameters
2: Optimize the prompt information of network failure, the built-in jquery can also run offline
3: Add getRangesList to return the end address of the module (.end attribute)
4: The floating window supports transparent border background, you need to set body{background-color: transparent}
5: Enhance the security of the core module to make the operation more stable and smoother
6: Fixed the problem that the scrolling result list did not load more data in some cases
H5GG v5.7 test:
1: Fix the problem that the size of the floating window is automatically reduced when dragging the floating window to the edge of the screen
2: Increase the area size of the draggable floating window at the top, and it is easier to drag in landscape mode
3: Optimize the original APP interface that can be touched outside the floating window area
4: The floating window is changed to opaque by default, and the transparency is adjusted using body{background-color: rgba(255,255,255,0.8)}
5: Added the js interface setWindowTouch, which can set the touch penetration of the floating window for full-screen drawing
7: Added js interface setButtonAction, you can set custom floating button click action
8: Optimize some js interfaces (non-h5gg engine), unified naming, temporarily compatible with old versions
H5GG v5.8 test:
1: Fix the problem that the ipad cannot touch the screen in full-screen drawing mode
2: Added js interface setButtonImage, you can set the icon of the floating button
3: Added js interface setWindowVisible, you can set the display or hide of the floating window
4: Optimize the underlying graphics engine of H5 to enhance the efficiency and performance of the graphics engine
H5GG v5.9 test:
1: Fix the problem that the window display size is not correct in the cross-process version
2: Fix the problem of insufficient memory when searching in a very large range
3: Reduce the memory usage of the search process, more smooth and stable
4: The proximity range of proximity search is limited to 2~4096
5: Added horizontal and vertical screen switching to automatically adjust the layout position of the floating window
6: Fix the problem that the floating window cannot be seen in ipad split screen mode
7: Fix the problem that the modification pop-up box cannot pop up after clicking the search result
H5GG v6.0 test:
1: The cross-process version of the app can now be displayed in a global suspension!
2: Fixed the problem of search crash and incorrect results in version 5.9
3: Hide icon and close menu button in cross-process app
4: Fixed the issue that the interface flickered when the mobile phone holding orientation was changed
5: Fix the problem that some APPs open the prompt that JS fails to load
H5GG v6.1 test:
1: Fix the possible flashback problem when opening the cross-process APP
2: Fix the problem of no response when clicking the floating button on the desktop
3: Fix the problem that the floating button goes off-screen when rotating the screen
H5GG v6.2 test:
1: Fix the problem that the lock screen cannot be unlocked after the inter-process hovering lock screen
2: Cross-process suspension mode supports global transparent background
3: Cross-process suspension mode supports touch penetration outside the suspension window
4: Cross-process suspension mode supports custom button actions
5: Separate the cross-process suspension module into a pluggable type
H5GG v6.3 test:
1: Perfect support for ipad split screen/suspension to automatically adjust the interface layout
2: Fix the problem that the position of the floating icon on the ipad split screen rotates the screen is disordered
3: Fix the abnormal display problem of the multi-task floating interface drawn across processes
4: Re-optimize the cross-process suspension and rotation method to automatically follow the current APP
5: Automatically clear the drag area, button actions, etc. before loading the new H5 page
H5GG v6.4 test:
1: The cross-process floating version no longer supports iPad split screen and floating
2: Added cross-process normal version, which supports iPad split screen and floating
3: Fix the problem that the display exceeds the border when the iPad is split-screen floating
4: Fix the abnormal problem of rotating layout on iPad when hovering across processes
5: Fix the problem that the cross-process suspension may be stuck on the ipad
6: Fix the problem that the general version may flash back when there is no network
H5GG v6.5 test:
1: Fix the problem that the cross-process version of full-screen drawing cannot touch the screen
2: Fix the problem that the hidden display menu may crash in full screen mode
3: Fix the problem that the height of the search result list may be displayed abnormally
4: Fix the problem that some ios13 pop-up prompt boxes are displayed in the lower layer
H5GG v6.6 test:
1: Cross-process full-screen suspension to adapt to ios12 system
2: There will be conflicting APPs in the forbidden part of the general version
H5GG v6.7 test:
1: Cross-process full-screen suspension adaptation to ios11 system suspension
2: Fix the problem that the uninstall deb of the cross-process version automatically ends
3: Add the prompt message that no target is selected in the cross-process version
4: Add js interface setLayoutAction to handle dynamic layout
5: Optimize some logical judgments to adapt to ios15 system jailbreak in advance
6: Optimize the automatic layout of the floating window to adapt to some old devices
H5GG v6.8 test:
1: The cross-process floating icon is adjusted to be displayed after the APP is opened
2: The cross-process suspension version supports the creation of custom icons for plugins
H5GG v6.9 update:
1: Fix the problem of no response when the cross-process suspension version is opened
2: Fix the problem of icon residue after uninstalling the cross-process version
H5GG v7.0 update:
1: Fixed the problem that the dylib generated by the production plug-in may crash on some device systems
2: Fix the problem that the prompt information of js script error is incomplete in some special cases
3: Support independent adjustment of the position or size of the floating window
H5GGv7.2 update:
1: Fix the problem that the search function may cause the engine to crash in some cases
2: Fix the problem that the search results may have missing data in some cases
3: Fixed the overlapping problem between the floating window interface and the status bar of some old devices
H5GGv7.3 update:
1: Fix the problem that ios12 cannot be suspended
2: Fix a memory leak bug
3: Optimize multi-language localization support
4: Optimization to improve security and stability
5: Fix the problem that the cross-process version of the APP may prompt that there is no network
6: Fix the setWindowVisible interface of the cross-process suspension version
H5GGv7.4 update:
1: Added h5gg.loadPlugin interface to call dylib plugin
2: Optimize the access speed of loading network html files
3: Fix a resource leak problem in the cross-process interface
4: Fix the problem that the floating button action is invalid due to loading frame
5: Fix the problem that touch penetration is not reset when switching html in cross-process hover version
6: Optimize the error prompt of H5 loading failure to filter redundant invalid prompts
H5GGv7.5 update:
1: Add the minimum version number of H5GG required by the h5gg.require interface
2: Fix the problem that the icon of the floating button of the APP is not reset when restarting the APP in the cross-process suspension version
2: Add reminder warning when calling deprecated API interface
<>
<html>
<head>
<title>H5GG</title>
<!--Set the mobile phone display mode, fill the width, display the original size, prohibit pinch-to-zoom-->
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--CSS Appearance Style Sheet-->
<style>
html {
    zoom : 1.0 ; /*Display the overall zoom 1.2 times on the phone*/
}

body {
    width: 100%;
    height: 100%;
    background-color: rgba(255,255,255,0.8);
}
* {
    /*Default text color*/
    color: #000;
    font-size: 12px;
    font-family: Arial, sans-serif;
    
   -webkit-tap-highlight-color: transparent;
   outline: none;
    
    /*Default layout border: gray dotted line, turn this on for easy viewing of the layout*/
    /*/
     border: 1px dashed gray;/**/
    
}

*:not(input,checkbox,textarea) {
    /* disable text selection */
   -webkit-touch-callout: none;
   -webkit-user-select: none;
   user-select: none; /* Non-prefixed version, currently */
}

input {
    background-color: rgba(0,0,0,0);
    height: 25px;
}

button {
    height: 30px;
    color: #3393EF;
    background-color: #84848450;
    display: inline-block;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
    outline: none;
    border: none;
    border-radius: 5px;
    padding: 0 6px;
    margin: 2px;
}

button:active {
    background-color: #fff;
    transform: translateY(2px);
}

input[type=radio]  {
    width:16px;
    height:16px;
    margin-right:6px;
    border:none;
    outline-style:none;
    -webkit-appearance:none;
    vertical-align:middle;
    border:1px solid #686868F0;
    border-radius:50%;
    margin:6px 4px;
}
input[type=radio]:checked {
    border:5px solid #2F7DCDF0;
    background:#E8E8E8;
}
    
input[type=checkbox]{
 visibility: hidden;
 vertical-align:middle; margin-bottom:2px;
 cursor: pointer;
 position: relative;
 width: 24px;
 height: 24px;
}
input[type=checkbox]::after{
 position: absolute;
 top: 0;
 margin-top:2px;
 width: 14px; height: 14px;
 border: 1px solid #686868;
 border-radius: 3px;
 background-color: rgba(0,0,0,0);
 display: inline-block;
 visibility: visible;
 text-align: center;
 content: ' ';
}
input[type=checkbox]:checked::after{
 content: "✓";
 color: #FFF;
 border-color: #B8B8B8;
 background-color: #4498F7;
 font-size: 12px;
 font-weight: bold;
}

input[type=range] {
  -webkit-appearance: none;
}
input[type=range]:focus {
  outline: none;
}
input[type=range]::-webkit-slider-runnable-track {
  height: 15px;
  cursor: pointer;
  animate: 0.2s;
  background: #68686830;
  border-radius: 1.3px;
  border: 0.2px solid #010101;
}
input[type=range]::-webkit-slider-thumb {
  border: 1px solid #000000;
  height: 18px;
  width: 16px;
  border-radius: 3px;
  background: #EEEEEEE0;
  cursor: pointer;
  -webkit-appearance: none;
  margin-top: -2px;
}
input[type=range]:focus::-webkit-slider-runnable-track {
  background: #367ebd;
}

.menubox {
    display: inline;
    padding: 5px;
    width: 300px;
    height: 20px;
    line-height :  20 px ; /*height is the same as line-height to center the text vertically*/
    text-align:center;
    background-color: #E8E8E890;
    border-radius: 5px;
}
.menubox.current {
    color: #E8E8E8;
    background-color: #848484;
}

.menuview {
    display:none;
}

.menuview.current {
    display:block;
    overflow-x: hidden;
    overflow-y: auto;
}
    
/* The whole part of the scroll bar */
.scrollbar {
    overflow-x: hidden;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
}
.scrollbar::-webkit-scrollbar {
    width :  5 px ; /* vertical scroll bar width */
    height :  5 px ; /* horizontal scroll bar height */
    background-color :  # F5F5F5 ; /* The overall background of the scroll bar, usually covered */
}
/* The track of the scroll bar (with Thumb inside) */
.scrollbar::-webkit-scrollbar-track {
    -webkit-box-shadow : inset 0  0  6 px  rgba ( 0 , 0 , 0 , 0.3 ); /* scrollbar track shadow */
    /*border-radius: 10px; /* Scroll bar track rounded corners*/
    background-color :  # F5F5F5 ; /* scrollbar track background */
}
/* Slider in the scroll bar */
.scrollbar::-webkit-scrollbar-thumb {
    border-radius :  15 px ; /* scroll bar slider rounded corners */
    -webkit-box-shadow : inset 0  0  6 px  rgba ( 0 , 0 , 0 , .3 ); /* scrollbar slider shadow */
    background-color :  # B8B8B8 ; /* scroll bar slider color */
}

.popup_container {
    position:absolute;
    z-index: 1000;
    left:50%;
    top:0;
}
    
#popup_search_edit {
    display:none;
    text-align: center;
    background-color: #FDFDFD;
    width:200px;
    height:150px;
    position:absolute;
    left:-100px; top:50px;
    border:1px solid #B8B8B880;
    border-radius: 5px;
    padding: 10px;
}
    
#popup_progress {
    display:none;
    text-align: center;
    background-color: #FDFDFD;
    width:200px;
    height:20px;
    position:absolute;
    left:-100px; top:100px;
    border:1px solid #B8B8B880;
    border-radius: 5px;
    padding: 10px;
    z-index: 2000;
}
    
#popup_loadscripts {
    display:none;
    text-align: center;
    background-color: #FDFDFD;
    width:250px;
    height:220px;
    position:absolute;
    left:-125px; top:20px;
    border:1px solid #B8B8B880;
    border-radius: 5px;
    padding: 10px;
}

#popup_proclist {
    display:none;
    text-align: center;
    background-color: #FDFDFD;
    width:180px;
    max-height:200px;
    position:absolute;
    left:-90px; top:50px;
    border:1px solid #B8B8B880;
    border-radius: 5px;
    padding: 10px;
}

#popup_proclist button {
    display: block;
    width: 100%;
    height: 26px;
    border-radius: 2px;
    font-weight:bold;
    color: black;
    text-align: left;
    background-color: #00000005;
}

table.datatype {
    border: 1px solid red;
    border-radius: 2px;
    border-collapse: collapse;
    border-style:hidden;
    box-shadow: 0 0 0 1px #3393EF;
}

.datatype td {
    cursor: hand;
    padding: 5px;
    color: #3393EF;
    border: 1px solid #3393EF;
    width: 22px;
    height: 15px;
    text-align: center;
}

.datatype td.selected {
    color: white;
    background-color: #3393EF;
}

.maskview {
    display: none;
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    filter: alpha(opacity=60);
    background-color: #777;
    z-index: 1;
    opacity:0.5;
}

#listdiv {
    display:block;
    overflow-x:hidden;
    overflow-y:scroll;
    height:100%;
}

#resultList tr.hilight td{
    color: #3393EF;
}

#resultList td {
    border-bottom:solid 1px #D1D1D1;
}
#resultList td font {
    font-size:12px;color:#848484
}

</style>

<script>

var h5gg_jquery_stub;

if(typeof $ == 'undefined')
    document.write("<script src=\"https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js\"><\/script>");

// Determine the search type based on the selected signed/unsigned number
function h5ggType(type)
{
    if($("input:radio[name=numtype]:checked").val()=="unsigned") {
        switch(type) {
            case "I8":
                return "U8";
            case "I16":
                return "U16";
            case "I32":
                return "U32";
            case "I64":
                return "U64";
        }
    }
    
    return type;
}

    
//page display finished event
document.addEventListener("DOMContentLoaded", function(){

    if(typeof $ == 'undefined') {
        alert("jquery load failed!");
        return;
    }

    /* Disable text selection and dragging */
    document.body.onselectstart = document.body.ondrag = function(){
        return  false ;
    }
    //The page automatically scrolls to the top after the text box is entered
    $("input").blur(function(){
        window.scroll(0,0);
    });
    
    //Activate webkit's button:active
    document.body.addEventListener('touchstart', function () {});
    
    //Binding menu click to switch subpages
    $("div.menubox").unbind('click').click(function(){
        $("div.menubox").removeClass("current");
        $("div.menuview").removeClass("current");
        $(this).addClass("current");
        
        var menuid = $(this).attr("menu");
        $("div#"+menuid).addClass("current");
    });
    
    $("#datavalue").focus(function(){
        var input = $(this);
        input.attr("type","number");
        setTimeout(function(){
            input.attr("type","text");
        }, 500);
    });
    
    
    $("#crossproc").click(function() {
        $("#popup_proclist").show();
        $("#maskview").show();
    });
        
    if(typeof h5gg!='undefined')
    {
        
        $("#version").text(h5gg_internel_version);
        
        //Clear the result list of the design demo
        onClickClearResults();
    
        //Set the title bar area to drag the floating window
        setWindowDrag ( 0 ,  0 ,  400 ,  80 ) ;
        
        // layout adjustment function
        setLayoutAction(function(w,h) {
            var  width  =  370 ;  var  height  =  370 ;  // default size
            if(w<h) {
                height  =  600 ;  //Increase the display height in portrait mode
            }
            width  =  Math . min ( width ,  w ) ;  //Adapt to the iPad floating window, the maximum width does not exceed
            height  =  Math . min ( height ,  h ) ;  // Adapt to old devices, the maximum height does not exceed
            var x = (w-width)/2;
            var y = (h-height)/2;
            if(w<h) {
                y = Math.max(20, y);
                height = Math.min(height, h-y);
            }
            setWindowRect(x,y,width,height);
        });

        var  checkprocs  =  function ( )
        {
            var  procs  =  h5gg . getProcList ( ) ;
            if ( procs )   //Not empty (null) means it has cross-process permissions
            {
                refreshProcList(procs);
                $("#crossproc").show();
                $("#closeMenu").hide();
                
                if(!$("#procname").attr('pid')) {
                    $("#popup_proclist").show();
                    $("#maskview").show();
                    $("#procname").text('');
                }
                
                setInterval(function(){
                    if($("#popup_proclist").is(":visible"))
                        refreshProcList(h5gg.getProcList());

                    if($("#procname").attr('pid'))
                    {
                        var  procs  =  h5gg . getProcList ( ) ;
                        var  alive  =  false ;
                        for(var i=0; i<procs.length; i++) {
                            if(procs[i].pid == $("#procname").attr('pid')) {
                                alive=true;
                                break;
                            }
                        }
                        
                        if(!alive) {
                            alert ( "The target process has ended\n\nPlease click the title bar to select a new target" ) ;
                            $("#procname").removeAttr('pid');
                            $("#procname").text('');
                        }
                    }
                    
                }, 1500);
                
            } else  {
                $("#crossproc").hide();
            }
            
        }; //end of checkprocs
        
        checkprocs();
        //setInterval(checkprocs, 1500);
    
    } //end of h5gg check
    
    //When clicking the address in the result list, the modification window pops up, and it needs to be bound after the listdiv refreshes the html
    $("table#resultList").on('click','tr', function()
    {
        $("table#resultList tr").removeClass("hilight");
        $(this).addClass("hilight");
        
        var address = $(this).attr("address");
        var datatype = $(this).attr("datatype");
        var datavalue = $(this).attr("datavalue");
        
        //Read the latest data of this address
        if(typeof h5gg!='undefined')
            datavalue = h5gg.getValue(address, h5ggType(datatype));
        
        showPopView ( "modify" ,  function ( type ,  value ) {
            
            if(!h5gg.setValue(address, value, h5ggType(type))) {
                alert ( "Modification failed, maybe the address is invalid!" ) ;
            }
            
            onClickRefreshResults();
            
        } ,  datatype ,  datavalue ) ;
    });
});

function refreshProcList(procs)
{
    $("#proctable button").remove();
    
    for(var i=0; i<procs.length; i++) {
        var  proc  =  procs [ i ] ;
        var btn = $("<button>"+proc.name+"</button>");
        btn.attr("pid", proc.pid);
        btn.click(function()
        {
            if(!h5gg.setTargetProc($(this).attr('pid'))) {
                alert ( "The target cannot be selected" ) ;
                return;
            }
            
            onClickClearResults();
            
            $("#procname").attr('pid', $(this).attr('pid'));
            $("#procname").text($(this).text());
            $("#popup_proclist").hide();
            $("#maskview").hide();
        });
        
        $("#proctable").append(btn);
    }
}

function refreshLocalSrcipts()
{
    $("table#localjslist tr").remove();
    
    var jsfiles = h5gg.getLocalScripts();

    setTimeout(function(){
        
        if(jsfiles.length==0) {
            $ ( "table#localjslist tbody" ) . append ( "<tr><td colspan=2>Searching the App's Documents data directory...<br/>Searching the App's .app program directory...<br/>No (*.js) or (*.html) files were found!</td></td>" ) ;
        }
        
        $ ( "table#localjslist tbody" ) . append ( '<tr><td style="border-right-style:none; color:blue">select from file manager</td><td style="border -left-style:none;width:45px"><button onclick="h5gg.pickScriptFile(onClickLoadScript)">browse</button></td></tr>' ) ;
        
        for(var i=0; i<jsfiles.length; i++) {
            var row = '<tr><td style="border-right-style:none;font-weight:bold;color:green">'+jsfiles[i].name+'</td><td style="border-left-style:none;width:45px"><button onclick="onClickLoadScript(\''+jsfiles[i].path+'\')">加载</button></td></tr>';
            $("table#localjslist tbody").append(row);
        }
    }, 300);
}

function onShowLoadScript(show)
{
    if(show) {
        $("#maskview").show();
        $("#popup_loadscripts").show();
        
        if(typeof h5gg!='undefined') refreshLocalSrcipts();
    } else {
        $("#maskview").hide();
        $("#popup_loadscripts").hide();
    }
}

function onClickLoadScript(url, type)
{
    if(!url) return;
    
    if(/^\w+\:/.test(url)==false) url = "file://"+url;
    
    try{
        url = new URL(url);
        url.searchParams.append("_", Math.random());
    }catch(e){
        alert ( "Invalid script URL" ) ;
        return;
    }
    
    $("#popup_progress").show();
    $("#maskview_script").show();
    
    if(type=='h5' || (!type&&!/\.js$/.test(url.pathname))) {
        window.location = url.href;
        return;
    }
    
    var script = document.createElement("script");

    script.type = "text/javascript";
    
    script.onload = function () {
      alert ( "JS script execution completed" ) ;
        $("#popup_progress").hide();
        $("#maskview_script").hide();
    };
    
    script.onerror = function () {
        alert ( "Failed to load! File does not exist or network error" ) ;
        $("#popup_progress").hide();
        $("#maskview_script").hide();
    };

    script.src = url.href;
    document.body.appendChild(script);
}


//Pop up the search or modify window
function showPopView(name, action, type, value)
{
    $("#maskview").show();
    $("#popup_search_edit").show();
    $("#popup_search_edit").find("B#titleBar").text(name);
    $("#popup_search_edit").find("button#action").text(name);
    
    if(type) {
        $("table#datatype td").each(function(){
            if($(this).text()==type)
                $(this).addClass("selected");
            else
                $(this).removeClass("selected");
        });
    }
    
    if(value) {
        $("input#datavalue").val(value);
    }
    
    $("input#datavalue").focus();
    
    $("#popup_search_edit").find("button#action").unbind("click").click(function(){
        var type = $("table#datatype td.selected").text();
        var value = $("input#datavalue").val();
        
        $("#popup_search_edit").hide();
        $("#popup_progress").show();
        
        setTimeout(function() {
            
            action(type, value);
            
            $("#popup_progress").hide();
            $("#maskview").hide();
        }, 200);
        
    });
    
    $("#popup_search_edit").find("button#cancel").unbind("click").click(function(){
        $("#maskview").hide();
        $("#popup_search_edit").hide();
    });
    
    $("table#datatype td").unbind("click").click(function(){
        $("table#datatype td").removeClass("selected");
        $(this).addClass("selected");
        $("input#datavalue").focus();
    });
}

function onClickClearResults()
{
    $("input#datavalue").val("");
    $("#results_count").hide();
    $("table#resultList tr").remove();
    $("table#resultList").attr("currentCount", 0);
    if(typeof h5gg!='undefined') h5gg.clearResults();
}

function loadResults(from, count)
{
    var maxCount = count;
    var skipCount = from;
    
    var results = h5gg.getResults(maxCount, skipCount);
    
    //alert("count"+count+":"+results.length+":"+results[0].address);
    
    for(var i=0; i<results.length; i++)
    {
        if(results[i].type=='F32' || results[i].type=='F64')
            results[i].value = '('+results[i].value+')';
        var row = '<tr address="'+results[i].address+'" datatype="'+results[i].type+'" datavalue="'+results[i].value+'"><td>'+(from+i+1)+'. '+results[i].address+'<br/><font>'+results[i].value+'</font></td></tr>';
        
        $("table#resultList tbody").append(row);
    }
}

function onClickRefreshResults(clean)
{
   $("table#resultList tr").remove();
   
   if(clean) {
       $("#listdiv").get(0).scroll(0,0);
       $("table#resultList").attr("currentCount", 0);
   }

    var count = h5gg.getResultsCount();
    $ ( "#results_count" ) . text ( "Total found" + count + "Results" ) ;
    $("#results_count").show();
    
    var currentCount = Number($("table#resultList").attr("currentCount"));
    if(isNaN(currentCount) || currentCount==0) {
        currentCount = 100;
        $("table#resultList").attr("currentCount", 100);
    }
    
    loadResults(0, currentCount);
}

function loadMoreResults() {
    console.log("load more data!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"+Math.random());
    
    //currently displayed number
    var currentCount = Number($("table#resultList").attr("currentCount"));
    
    //Display 100 items each time
    $("table#resultList").attr("currentCount", currentCount+100);
    
    loadResults(currentCount, 100);
}

function showMoreResults(div)
{
    var lh = div.scrollHeight - div.scrollTop;
    console.log(div.clientHeight+","+div.offsetHeight +" : " +div.scrollTop+","+div.scrollHeight + " : " + lh);
    
    if(lh <= div.clientHeight) {
        console.log("trigger bottom!!!!!!!!!!!!!!!!!!!!!!!!!!!");
        loadMoreResults();
    }
}

function onClickEditAll()
{
    /*
    if($("table#resultList tr").length==0) {
        alert("No modifiable data");
        return;
    }*/
    
    showPopView ( "Modify all" ,  function ( type ,  value ) {

        var count = h5gg.editAll(value, h5ggType(type));
        
        onClickRefreshResults();
        
        alert ( "successfully modified" + count + "data" ) ;
    });
}

function onClickSearchNumber()
{
    showPopView ( "Search value" ,  ​​function ( type ,  value )  {
        
        h5gg.setFloatTolerance($("#float_tolerance").val());
        
        var memoryFrom = $("input#range_min").val();
        var memoryTo = $("input#range_max").val();
        h5gg.searchNumber(value, h5ggType(type), memoryFrom, memoryTo);
        
        onClickRefreshResults(true);
    });
}

function onClickSearchNearby()
{
    /*
    if($("table#resultList tr").length==0) {
        alert("No data to continue searching");
        return;
    }*/
    
    showPopView ( "Search for nearby values" ,  function ( type ,  value ) {
        
        h5gg.setFloatTolerance($("#float_tolerance").val());
        
        var nearbyRange = $("input#nearby_range").val();
        h5gg.searchNearby(value, h5ggType(type), nearbyRange);
        
        onClickRefreshResults(true);
    });
}
    
function onClickMakeTweak()
{
    alert ( "Make your own dylib\n\nThe first step: select the floating button icon file" ) ;
    h5gg.pickScriptFile(function(icon){
        
        alert ( "Step 2: Select the default html file to load" ) ;
        
        h5gg.pickScriptFile(function(html) {
            
            alert(h5gg.makeTweak(icon, html));
            
        }, ["public.html"]);
        
    }, ["public.image"]);
}

</script>

</head>
<body bgcolor="#E8E8E8" style="margin:0;">
<!--Title bar-->
<div id="titleBar" style="background-color:#D1D1D1; padding:5px; margin:0px; height:12px">
&nbsp;<font style="color:green">H5</font><font style="color:red">GG</font>&nbsp;v<span id="version"></span>
<span id="crossproc" style="display:none">
<font style="color:blue">&nbsp;Process&nbsp;</font><font id="procname">procname</font>
</span>
    
<div id="closeMenu" style="float:right; font-size:16px; line-height:14px; font-family: Arial, sans-serif;" onclick="setWindowVisible(false)">&nbsp;X&nbsp;</div>
</div>
<!--Use a table to layout the left and right columns-->
<table id="bodyView" width="100%" style="table-layout:fixed;height: calc(100% - 22px) ;">
<tr>
<td style="vertical-align:top;width:130px;border-right:solid 2px #D1D1D1;">
<div>
Range Min:<input id="range_min" style="width:80px;padding-left:0" value="0x00000000" />
<br/>
Range Max:<input id ="range_max" style="width:80px;padding-left:0"value="0x200000000" />
<br/>
<label><input type=radio name="numtype" value="signed" checked />Signed</label>
<label><input type=radio  name="numtype" value="unsigned" />Unsigned</label>
<br/>
<button onclick="onClickSearchNumber()">Number</button>
<button onclick="onClickSearchNearby()">Nearby</button>
<br/>
<button onclick="onClickClearResults()">New</button>
<button onclick="onClickEditAll()">Edit All</button>
<button onclick="onClickRefreshResults()">Refresh</button>
<br/>
<button onclick="onShowLoadScript(true)">Open</button>
<button onclick="onClickMakeTweak()">Make</button>
<br/>
Nearby range:<input id="nearby_range" style="width:78px" value="0x100"/>
<br/>
Float error:<input id="float_tolerance" style="width:78px" value="0.0"/>
<br/>
<p id="results_count" style="display:none">found <span>0</span> results</p>
</div>
</td>
<td style="vertical-align:top;">
<div id="listdiv" class="scrollbar" ontouchend="showMoreResults(this);">
<table id="resultList" style="width:100%;cursor:hand;">
<tr address="0x012345678" datatype="F64" datavalue="123"><td>1.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>2.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>3.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>4.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>5.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>6.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>7.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>8.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>9.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>10.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>11.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>12.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>13.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>14.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>15.0x102345678<br/><font>112233</td></tr>
<tr address="0x012345678" datatype="F64" datavalue="123"><td>16.0x102345678<br/><font>0.112233112233112233112233112233112233</td></tr>
</table>
</div>

</td>
</tr>
</table>

<!--Global gray mask layer (used when the search box pops up)-->
<div id="maskview" class="maskview"></div>

<!--Full screen center layout layer-->
<div class="popup_container">
    
<div id="popup_search_edit">
<B  id =" titleBar "> Search Value </ B>
<br/><br/>
<center>
<table id="datatype" class="datatype">
<tr>
<td>F32</td><td>F64</td><td>I8</td><td>I16</td><td class="selected">I32</td><td>I64</td>
</tr>
</table>
</center>
<br/>
<input type="text" id="datavalue" style="width:100%; border:none" placeholder="数值" />
<hr/><br/>
<button id="cancel">取消</button>
&nbsp;&nbsp;&nbsp;
<button  id =" action "> search value </button>
</div>


<!--Centered loading script window, hidden by default-->
<div id="popup_loadscripts" class="popup_view3">
<center>
<div  class = " menubox current " menu = " localjs " onclick = " refreshLocalSrcipts() "> load locally ⟳ </ div>
<div  class =" menubox " menu =" netjs "> netload </ div>
<div style="float:right; font-size:16px; font-family: Arial, sans-serif;" onclick="onShowLoadScript(false)">&nbsp;X&nbsp;</div>
</center>
<hr/>
<div id="localjs" class="menuview current scrollbar" style="height:190px">
<table id="localjslist" style="width:100%;" border="1" cellspacing=0 cellpadding=0>
<tr> <td  style =" border-right-style:none;color:blue "> Choose another location </ td> <td  style =" border-left-style:none;width:45px "> <button> Browse </button> </ td> </ tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
<tr><td style="border-right-style:none;">测试脚本1.js</td><td style="border-left-style:none;width:45px"><button>加载</button></td></tr>
</table>
</div>
<div id="netjs" class="menuview">
<br/><br/>
<input  id =" netjsurl " style =" width:100% " placeholder =" Please enter the URL link of the js/html file starting with http/https " />
<br/><br/><br/>
<hr/>
<button  onclick =" onClickLoadScript($('#netjsurl').val(), 'js') "> Load JS script </button>
<button  onclick =" onClickLoadScript($('#netjsurl').val(), 'h5'); "> Load H5 page </button>
</div>

<!--Running the script gray mask (used when executing the script)-->
<div id="maskview_script" class="maskview"></div>

</div>

<!--Centered prompt box, hidden by default-->
<div id="popup_progress">
<center>
    In progress...
</center>
</div>

<div id="popup_proclist">
<center>
Choose a target
<hr/>
<div id="proctable" class="scrollbar" style="min-height:50px; max-height:170px">
<button>Process1</button>
<button>Process2</button>
<button>Process3</button>
<button>Process4</button>
<button>Process5</button>
<button>Process6</button>
<button>Process7</button>
<button>Process8</button>
</div>
</center>
</div>


<!--End of full-screen centered layout layer-->
</div>

</body>
</html>